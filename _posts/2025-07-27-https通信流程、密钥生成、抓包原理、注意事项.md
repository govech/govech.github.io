---
title: httpsé€šä¿¡æµç¨‹ã€å¯†é’¥ç”Ÿæˆã€æŠ“åŒ…åŸç†ã€æ³¨æ„äº‹é¡¹
date: 2025-07-27
---



HTTPSï¼ˆHyperText Transfer Protocol Secureï¼‰æ˜¯åœ¨ HTTP åŸºç¡€ä¸ŠåŠ äº†ä¸€å±‚ TLS/SSL åŠ å¯†åè®®ï¼Œç”¨äºä¿éšœæ•°æ®çš„ **ä¿å¯†æ€§**ã€**å®Œæ•´æ€§** å’Œ **èº«ä»½éªŒè¯**ã€‚æ•´ä¸ªé€šä¿¡è¿‡ç¨‹æ¶‰åŠå¤šä¸ªåŠ å¯†æŠ€æœ¯ï¼Œç‰¹åˆ«æ˜¯ **å¯¹ç§°åŠ å¯†å¯†é’¥çš„ç”Ÿæˆä¸åå•†è¿‡ç¨‹** æ˜¯å…¶æ ¸å¿ƒéƒ¨åˆ†ä¹‹ä¸€ã€‚

## ä¸€ã€HTTPS é€šä¿¡æ•´ä½“æµç¨‹æ¦‚è§ˆ

æˆ‘ä»¬ä»¥å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨æˆ– Appï¼‰è®¿é—®ä¸€ä¸ª HTTPS ç½‘ç«™ä¸ºä¾‹ï¼Œæ¢³ç†å®Œæ•´æµç¨‹ï¼š

### 1. å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ˆClient Helloï¼‰

å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ `Client Hello` æ¶ˆæ¯ï¼ŒåŒ…å«ï¼š

- æ”¯æŒçš„ TLS åè®®ç‰ˆæœ¬
- æ”¯æŒçš„åŠ å¯†å¥—ä»¶åˆ—è¡¨ï¼ˆå¦‚ RSAã€ECDHEï¼‰
- æ”¯æŒçš„å‹ç¼©ç®—æ³•
- å®¢æˆ·ç«¯éšæœºæ•° `client_random`ï¼ˆ32å­—èŠ‚ï¼‰

### 2. æœåŠ¡å™¨å“åº”ï¼ˆServer Helloï¼‰

æœåŠ¡å™¨æ”¶åˆ°åï¼Œå›å¤ `Server Hello` æ¶ˆæ¯ï¼ŒåŒ…å«ï¼š

- é€‰æ‹©çš„åè®®ç‰ˆæœ¬å’ŒåŠ å¯†å¥—ä»¶
- æœåŠ¡å™¨çš„éšæœºæ•° `server_random`ï¼ˆ32å­—èŠ‚ï¼‰
- æœåŠ¡å™¨æ•°å­—è¯ä¹¦ï¼ˆåŒ…å«å…¬é’¥ã€æœåŠ¡å™¨èº«ä»½ã€CA ç­¾åï¼‰

### 3. å®¢æˆ·ç«¯ç”Ÿæˆé¢„ä¸»å¯†é’¥å¹¶å‘é€ç»™æœåŠ¡å™¨

- å®¢æˆ·ç«¯ç”Ÿæˆ 48 å­—èŠ‚çš„é¢„ä¸»å¯†é’¥ (Pre-Master Secret)

- å®¢æˆ·ç«¯ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦ä¸­çš„å…¬é’¥åŠ å¯†é¢„ä¸»å¯†é’¥ Pre-Master Secret â†’ Encrypted Pre-Master Secret

- å®¢æˆ·ç«¯å‘é€åŠ å¯†çš„é¢„ä¸»å¯†é’¥ç»™æœåŠ¡å™¨

### 4. åŒæ–¹ä½¿ç”¨ç›¸åŒçš„ä¼ªéšæœºå‡½æ•° (PRF) ç”Ÿæˆä¸»å¯†é’¥ï¼š

- Master Secret = PRF(Pre-Master Secret, "master secret",ClientRandom + ServerRandom)

- å…¶ä¸­

  - Pre-Master Secret: 48å­—èŠ‚

  - "master secret": å›ºå®šå­—ç¬¦ä¸²

  - ClientRandom: 32å­—èŠ‚å®¢æˆ·ç«¯éšæœºæ•°

  - ServerRandom: 32å­—èŠ‚æœåŠ¡å™¨éšæœºæ•°

  - è¾“å‡º: 48å­—èŠ‚çš„ Master Secret

------

## äºŒã€å¯†é’¥åå•†ä¸ç”Ÿæˆï¼ˆå¯¹ç§°åŠ å¯†å¯†é’¥çš„äº§ç”Ÿï¼‰

HTTPS ä½¿ç”¨ **æ··åˆåŠ å¯†**ï¼šå¯¹ç§°åŠ å¯†ç”¨äºä¼ è¾“æ•°æ®ï¼Œéå¯¹ç§°åŠ å¯†ç”¨äºå¯†é’¥åå•†ã€‚

å…³é”®åœ¨äºç”Ÿæˆä¸€ä¸ª **å¯¹ç§°åŠ å¯†çš„â€œå…±äº«å¯†é’¥â€ session key**ï¼Œ**ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼**ï¼š

æ— è®ºæ˜¯ RSA å¯†é’¥äº¤æ¢è¿˜æ˜¯ ECDHE å¯†é’¥äº¤æ¢ï¼Œ**æœ€æ ¸å¿ƒçš„ç›®æ ‡éƒ½æ˜¯è®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨ä¸æ³„éœ²ç§˜å¯†çš„å‰æä¸‹ï¼Œæœ€ç»ˆå„è‡ªç‹¬ç«‹å¾—åˆ°ç›¸åŒçš„ `Pre-Master Secret` (é¢„ä¸»å¯†é’¥)ã€‚** è¿™ä¸ª `Pre-Master Secret` æ˜¯åç»­ç”ŸæˆçœŸæ­£ç”¨äºåŠ å¯†æ•°æ®çš„å¯¹ç§°ä¼šè¯å¯†é’¥(`Session Key`)çš„ç§å­ï¼

**å·®å¼‚çš„æœ¬è´¨ï¼šå¦‚ä½•ä¿æŠ¤ `Pre-Master Secret` çš„å®‰å…¨**

| **æ ¸å¿ƒæ­¥éª¤**                                   | **RSA å¯†é’¥äº¤æ¢ (è¾ƒæ—§æ–¹å¼)**                                  | **ECDHE å¯†é’¥äº¤æ¢ (ç°ä»£ä¸»æµæ–¹å¼)**                            |
| :--------------------------------------------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| **1. æœåŠ¡å™¨èº«ä»½éªŒè¯**                          | âœ… **å¿…å¤‡ä¸”ç›¸åŒï¼š** æœåŠ¡å™¨å‘é€å…¶è¯ä¹¦ï¼ˆå«æœåŠ¡å™¨å…¬é’¥ `Pub_S`ï¼‰ï¼Œå®¢æˆ·ç«¯éªŒè¯è¯ä¹¦åˆæ³•æ€§ã€‚ | âœ… **å¿…å¤‡ä¸”ç›¸åŒï¼š** æœåŠ¡å™¨å‘é€å…¶è¯ä¹¦ï¼ˆå«æœåŠ¡å™¨å…¬é’¥ `Pub_S`ï¼‰ï¼Œå®¢æˆ·ç«¯éªŒè¯è¯ä¹¦åˆæ³•æ€§ã€‚ |
| **2. `Pre-Master Secret` çš„æ¥æº**              | â— **ç”±å®¢æˆ·ç«¯ç‹¬å®¶ç”Ÿæˆï¼š** å®¢æˆ·ç«¯åœ¨æœ¬åœ° **éšæœºç”Ÿæˆ** ä¸€ä¸ª `Pre-Master Secret`ã€‚ | âš¡ **ç”±åŒæ–¹åä½œè®¡ç®—ç”Ÿæˆï¼š** `Pre-Master Secret` æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ **é€šè¿‡æ•°å­¦è®¡ç®—å…±åŒå¾—å‡ºçš„ç»“æœ (`S`)**ï¼ŒåŒæ–¹å‡å‚ä¸ç”Ÿæˆã€‚ |
| **3. ä¼ è¾“ `Pre-Master Secret` (æˆ–å…¶å…³é”®æˆåˆ†)** | ğŸ›¡ï¸ **å®¢æˆ·ç«¯å°† `Pre-Master Secret` åŠ å¯†åä¼ è¾“ï¼š** â€¢ å®¢æˆ·ç«¯ä½¿ç”¨**æœåŠ¡å™¨çš„è¯ä¹¦å…¬é’¥ `Pub_S` åŠ å¯†**è‡ªå·±ç”Ÿæˆçš„ `Pre-Master Secret`ã€‚ â€¢ å‘é€ `EncryptedPreMasterSecret`ã€‚ â€¢ **å®‰å…¨æ€§ä¾èµ–äºï¼š** åªæœ‰æ‹¥æœ‰å¯¹åº”ç§é’¥çš„æœåŠ¡å™¨èƒ½è§£å¯†ã€‚**`Pre-Master Secret` æœ¬èº«åœ¨ç½‘ç»œä¸­æš´éœ²ï¼ˆè™½ç„¶æ˜¯åŠ å¯†çš„ï¼‰ã€‚** | ğŸŒ **åŒæ–¹äº¤æ¢å…¬å¼€è®¡ç®—å‚æ•° (ä¸ä¼ ç§˜å¯†æœ¬èº«)ï¼š** â€¢ æœåŠ¡å™¨ç”Ÿæˆä¸´æ—¶å…¬ç§é’¥å¯¹(`s_priv`, `Pub_S_Temp`), å‘é€ `Pub_S_Temp` (å¹¶ç­¾å)ã€‚ â€¢ å®¢æˆ·ç«¯ç”Ÿæˆä¸´æ—¶å…¬ç§é’¥å¯¹(`c_priv`, `Pub_C_Temp`), å‘é€ `Pub_C_Temp`ã€‚ â€¢ **å®¢æˆ·ç«¯è®¡ç®— `S = ECDH(c_priv, Pub_S_Temp)`** â€¢ **æœåŠ¡å™¨è®¡ç®— `S = ECDH(s_priv, Pub_C_Temp)`** â€¢ **åŒæ–¹è®¡ç®—å‡ºçš„ `S` ç›¸åŒï¼Œè¿™ä¸ª `S` å°±æ˜¯ `Pre-Master Secret`** â€¢ **`Pre-Master Secret` (`S`) ä»æœªåœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼** (æ— è®ºæ˜¯æ˜æ–‡è¿˜æ˜¯å¯†æ–‡å½¢å¼)ã€‚ |
| **4. `Pre-Master Secret` çš„ä¿å¯†æ€§æ ¸å¿ƒä¾èµ–**    | ğŸ”‘ **æœåŠ¡å™¨çš„é•¿æœŸç§é’¥ (`Priv_S`)**ï¼š â€¢ å¦‚æœæœåŠ¡å™¨ç§é’¥ **æœªæ¥** æ³„éœ²ï¼Œæ”»å‡»è€…èƒ½è§£å¯†è¿‡å»æˆªè·çš„æ‰€æœ‰ `EncryptedPreMasterSecret`ï¼Œä»è€Œç ´è§£æ‰€æœ‰å†å²åŠ å¯†ä¼šè¯ã€‚ â€¢ **ç¼ºä¹å‰å‘å®‰å…¨æ€§ (Forward Secrecy)**ã€‚ | ğŸ”’ **ä¸´æ—¶ç§é’¥çš„ä¸€æ¬¡æ€§ (`s_priv`, `c_priv`)**ï¼š â€¢ æ¯æ¬¡ä¼šè¯éƒ½ä½¿ç”¨**ä¸´æ—¶ç”Ÿæˆ**çš„å¯†é’¥å¯¹ã€‚ â€¢ å³ä½¿æœåŠ¡å™¨é•¿æœŸç§é’¥ (`Priv_S`) **æœªæ¥** æ³„éœ²ï¼Œæ”»å‡»è€…ä¹Ÿæ— æ³•æ ¹æ®æˆªè·çš„ `Pub_S_Temp` å’Œ `Pub_C_Temp` è®¡ç®—å‡ºæœ¬æ¬¡ä¼šè¯çš„ `S` (`Pre-Master Secret`)ï¼Œå› ä¸ºè¿˜éœ€è¦å·²é”€æ¯çš„ä¸´æ—¶ç§é’¥ã€‚ â€¢ **æä¾›å‰å‘å®‰å…¨æ€§ (Forward Secrecy)**ã€‚ â€¢ ç­¾åä¾èµ–é•¿æœŸç§é’¥ï¼Œä½†ç­¾åä¿æŠ¤çš„æ˜¯ä¸´æ—¶å…¬é’¥å’Œå‚æ•°çš„çœŸå®æ€§ï¼Œä¸æ¶‰åŠç§˜å¯†æœ¬èº«çš„ä¼ è¾“ã€‚ |
| **5. åç»­æ­¥éª¤ä¸€è‡´**                            | ğŸ”„ **ç›¸åŒï¼š** åŒæ–¹ä½¿ç”¨ â€¢ `Pre-Master Secret` (`S` for ECDHE) â€¢ `Client Random` â€¢ `Server Random` é€šè¿‡ä¼ªéšæœºå‡½æ•°(PRF)è®¡ç®—å‡º `Master Secret`ã€‚å†æ´¾ç”Ÿå‡ºæœ€ç»ˆçš„å¯¹ç§°ä¼šè¯å¯†é’¥ (`Session Key`) å’Œ MAC/IV ç­‰å‚æ•°ã€‚åç»­é€šä¿¡ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ | ğŸ”„ **ç›¸åŒï¼š** åŒæ–¹ä½¿ç”¨ â€¢ `Pre-Master Secret` (`S` for ECDHE) â€¢ `Client Random` â€¢ `Server Random` é€šè¿‡ä¼ªéšæœºå‡½æ•°(PRF)è®¡ç®—å‡º `Master Secret`ã€‚å†æ´¾ç”Ÿå‡ºæœ€ç»ˆçš„å¯¹ç§°ä¼šè¯å¯†é’¥ (`Session Key`) å’Œ MAC/IV ç­‰å‚æ•°ã€‚åç»­é€šä¿¡ä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†ã€‚ |

## ä¸‰ã€**ç¦ç”¨æ‰€æœ‰è¯ä¹¦æ ¡éªŒå’ŒåŸŸåæ ¡éªŒ**ï¼ˆå®¹æ˜“è¢«ä¸­é—´äººæ”»å‡»ï¼Œä»…é™è°ƒè¯•ä½¿ç”¨ï¼‰

```kotlin
val trustAllCerts = arrayOf<TrustManager>(object : X509TrustManager {
    override fun checkClientTrusted(chain: Array<out X509Certificate>?, authType: String?) {}
    override fun checkServerTrusted(chain: Array<out X509Certificate>?, authType: String?) {}
    override fun getAcceptedIssuers(): Array<X509Certificate> = arrayOf()
})

val sslContext = SSLContext.getInstance("TLS")
sslContext.init(null, trustAllCerts, SecureRandom())

val client = OkHttpClient.Builder()
    .sslSocketFactory(sslContext.socketFactory, trustAllCerts[0] as X509TrustManager)
    .hostnameVerifier { _, _ -> true }
    .build()

```

## å››ã€Okhttpå¤„ç†è‡ªç­¾è¯ä¹¦ï¼š

```kotlin
package com.example.lib_network

import android.content.Context
import java.io.InputStream
import java.security.KeyStore
import java.security.SecureRandom
import java.security.cert.CertificateFactory
import java.security.cert.X509Certificate
import javax.net.ssl.*
/**
 * ç”¨äºåŠ è½½è‡ªå®šä¹‰è¯ä¹¦å¹¶åˆ›å»ºSSLè¿æ¥
 *
 * å¦‚ä½•ä½¿ç”¨ï¼š
 *     1ã€åœ¨res/rawç›®å½•ä¸‹åˆ›å»ºè¯ä¹¦æ–‡ä»¶my_cert
 *     2ã€val (sslSocketFactory, trustManager) = TrustedCertificateProvider.provideSSLContext(MyApplication.mContext)
 *     3ã€val okHttpClient = OkHttpClient.Builder().sslSocketFactory(sslSocketFactory, trustManager)
 */
object TrustedCertificateProvider {

    /**
     * æ·»åŠ è¯ä¹¦ ä»res/rawä¸­è¯»å–å¤šä¸ªè¯ä¹¦
     * è®°å¾—æ›¿æ¢ä¸ºçœŸå®çš„è¯ä¹¦ï¼Œä¾‹å¦‚ï¼š val certResIds = listOf(R.raw.my_cert, R.raw.my_pem)
     */
    val certResIds = listOf(1, 2)


    /**
     * æä¾›SSLä¸Šä¸‹æ–‡é…ç½®
     * åŠ è½½å¤šä¸ª X.509 æ ¼å¼è¯ä¹¦ï¼ˆæ”¯æŒ .crt/.pemï¼‰ï¼Œè¿”å› SSL é…ç½®ï¼ˆå·¥å‚ + ä¿¡ä»»ç®¡ç†å™¨ï¼‰
     * @param context Androidä¸Šä¸‹æ–‡ï¼Œç”¨äºè®¿é—®èµ„æºæ–‡ä»¶
     * @return Pair<SSLSocketFactory, X509TrustManager> SSLSocketå·¥å‚å’Œä¿¡ä»»ç®¡ç†å™¨çš„é…å¯¹
     */
    fun provideSSLContext(context: Context): Pair<SSLSocketFactory, X509TrustManager> {
        val certStreams = loadRawCertificateStreams(context, certResIds)
        val certificateFactory = CertificateFactory.getInstance("X.509")
        val keyStore = KeyStore.getInstance(KeyStore.getDefaultType()).apply {
            load(null, null) // åˆå§‹åŒ–ç©º keystore
            certStreams.forEachIndexed { index, stream ->
                stream.use {
                    val cert = certificateFactory.generateCertificate(it) as X509Certificate
                    setCertificateEntry("cert_$index", cert)
                }
            }
        }

        val trustManagerFactory =
            TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm()).apply {
                init(keyStore)
            }

        val trustManagers = trustManagerFactory.trustManagers
        require(trustManagers.size == 1 && trustManagers[0] is X509TrustManager) {
            "ä¸æ”¯æŒçš„ TrustManager é…ç½®"
        }

        val trustManager = trustManagers[0] as X509TrustManager

        val sslContext = SSLContext.getInstance("TLS").apply {
            init(null, arrayOf<TrustManager>(trustManager), SecureRandom())
        }

        return sslContext.socketFactory to trustManager
    }

    /**
     * ä» res/raw è¯»å–å¤šä¸ªè¯ä¹¦ InputStream
     * @param context Android ä¸Šä¸‹æ–‡
     * @param rawResIds List<R.raw.xxx>
     */
    private fun loadRawCertificateStreams(
        context: Context,
        rawResIds: List<Int>
    ): List<InputStream> {
        return rawResIds.map { context.resources.openRawResource(it) }
    }
}
```

## äº”ã€httpsæŠ“åŒ…åŸç†

**æœ¬è´¨ä¸Šæ˜¯åœ¨ TLS åŠ å¯†å»ºç«‹ä¹‹å‰æˆ–ä¹‹ä¸­ï¼Œè·å–åŠ å¯†å¯†é’¥æˆ–ä¸­é—´å¯†é’¥åå•†è¿‡ç¨‹çš„ä¿¡æ¯ï¼Œä»è€Œä½¿æŠ“åŒ…å·¥å…·èƒ½å¤Ÿè§£å¯† HTTPS åŠ å¯†æµé‡ã€‚è¿™ä¸åŒäºæŠ“ HTTP åŒ…ç›´æ¥æ˜æ–‡æŸ¥çœ‹å†…å®¹ï¼ŒHTTPS çš„æ‰€æœ‰å†…å®¹åœ¨ç½‘ç»œä¸Šä¼ è¾“å‰éƒ½ä¼šè¢«åŠ å¯†ï¼Œå› æ­¤æŠ“åŒ…å·¥å…·å¿…é¡»é€šè¿‡â€œä¸­é—´äººâ€æˆ–â€œå¯†é’¥æ³¨å…¥â€ç­‰æ–¹å¼ç»•è¿‡ TLS çš„åŠ å¯†ä¿æŠ¤ã€‚**

> **HTTPS æ˜¯åŠ å¯†çš„ HTTPï¼ŒæŠ“åŒ…è™½ç„¶èƒ½çœ‹åˆ° TLS å±‚ï¼Œä½†ä¸èƒ½ç›´æ¥çœ‹åˆ° HTTP æ˜æ–‡ã€‚**

- æ™®é€šæŠ“åŒ…ï¼ˆå¦‚ Wiresharkï¼‰ï¼šåªèƒ½çœ‹åˆ° **TLS æ¡æ‰‹ä¿¡æ¯å’Œå¯†æ–‡æ•°æ®**
- æƒ³çœ‹åˆ°æ˜æ–‡ï¼ˆå¦‚ `POST` å†…å®¹ã€è¯·æ±‚å¤´ã€å“åº”ä½“ç­‰ï¼‰ï¼Œå°±éœ€è¦ï¼š
  1. æ‹¿åˆ°åŠ å¯†å¯†é’¥ï¼ˆå¯¹ç§° session keyï¼‰
  2. æˆ–ä¼ªé€ ä¸­é—´äººå¹¶è§£å¯†é€šä¿¡å†…å®¹

### 1ã€HTTPS æŠ“åŒ…çš„ä¸‰ç§å¸¸è§åŸç†æ–¹å¼

| æ–¹æ³•                              | åŸç†                           | ä¼˜ç¼ºç‚¹                         | ç”¨é€”               |
| --------------------------------- | ------------------------------ | ------------------------------ | ------------------ |
| **æµè§ˆå™¨ SSLKEYLOGFILE**          | æµè§ˆå™¨ä¸»åŠ¨å¯¼å‡ºå¯¹ç§°å¯†é’¥         | å®‰å…¨ã€åˆæ³•ï¼Œé€‚åˆå­¦ä¹            | æœ¬åœ°æŠ“åŒ…è°ƒè¯•       |
| **ä¸­é—´äººä»£ç†ï¼ˆMITMï¼‰**            | æ‹¦æˆª TLS æ¡æ‰‹ï¼Œä¼ªé€ æœåŠ¡å™¨è¯ä¹¦  | éœ€è¦å®‰è£…ä»£ç†è¯ä¹¦ï¼Œæœ‰è¢«æ£€æµ‹é£é™© | å¼€å‘è°ƒè¯•ã€æ¸—é€æµ‹è¯• |
| **æœåŠ¡ç«¯ç§é’¥è§£å¯†ï¼ˆä»… RSA æ¡æ‰‹ï¼‰** | ä½¿ç”¨ç§é’¥è§£å¯† pre_master_secret | TLS 1.3 æ— æ³•ä½¿ç”¨               | è€æ—§ç³»ç»Ÿåˆ†æ       |

### 2ã€ä¸¾ä¾‹è¯´æ˜Charles æŠ“ HTTPS æµé‡æ€»ä½“æµç¨‹ï¼ˆMITM æŠ“åŒ…ï¼‰

> Charles å¹¶ä¸ä¼šç›´æ¥ç ´è§£ TLSï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯**ä¼ªé€ å—ä¿¡ä»»çš„è¯ä¹¦ï¼Œå¹¶ä½œä¸ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººä»£ç†**ã€‚

#### **ï¼ˆä¸€ï¼‰æµç¨‹å¦‚ä¸‹Charlesï¼š**

- æ‹¦æˆª App è¯·æ±‚
- ä¼ªé€ æœåŠ¡å™¨è¯ä¹¦ â†’ ä¸ App å»ºç«‹ TLS1
- çœŸæ­£è¿æ¥æœåŠ¡å™¨ â†’ ä¸æœåŠ¡å™¨å»ºç«‹ TLS2
- ä¸­é—´è§£å¯†æ•°æ® â†’ å®ç° HTTPS æ˜æ–‡æŠ“åŒ…

#### **ï¼ˆäºŒï¼‰ä» Android 7 å¼€å§‹ï¼Œç³»ç»Ÿé»˜è®¤ App ä¸ä¿¡ä»»â€œç”¨æˆ· CA è¯ä¹¦â€**

- å¦‚æœä½ æ‹¥æœ‰ **root æƒé™**ï¼Œå¯ä»¥å°† Charles çš„è¯ä¹¦å¯¼å…¥ä¸º **ç³»ç»Ÿä¿¡ä»»çš„æ ¹è¯ä¹¦**ï¼Œè§£å†³ä¸Šé¢çš„é—®é¢˜

#### ï¼ˆä¸‰ï¼‰App å¯ç”¨ SSL Pinning çš„æ‹¦æˆªéš¾ç‚¹

å³ä½¿è¯ä¹¦å®‰è£…å®Œæ¯•ï¼Œä¸€äº›å®‰å…¨æ€§è¾ƒé«˜çš„ Appï¼ˆå¦‚é“¶è¡Œã€å¾®ä¿¡ã€æ”¯ä»˜ç±»ï¼‰ä¼šå¯ç”¨ï¼š

> **SSL Pinningï¼ˆè¯ä¹¦é”å®šï¼‰**ï¼šå®¢æˆ·ç«¯åªä¿¡ä»»**ç‰¹å®šå…¬é’¥/è¯ä¹¦å“ˆå¸Œ**ï¼Œæ— è§†ç³»ç»Ÿä¿¡ä»»ã€‚

#####  **SSL Pinning å·¥ä½œåŸç†ï¼š**

- App å†…åµŒæŒ‡å®šæœåŠ¡å™¨å…¬é’¥æˆ–è¯ä¹¦æŒ‡çº¹
- åœ¨ TLS æ¡æ‰‹åä¼šä¸»åŠ¨æ¯”å¯¹è¯ä¹¦æ˜¯å¦åŒ¹é…
- å¦‚æœä½ ç”¨ Charles çš„ä¼ªé€ è¯ä¹¦ï¼Œ**å³ä½¿è¢«ç³»ç»Ÿä¿¡ä»»ï¼ŒApp ä¹Ÿä¼šæ‹’ç»è¿æ¥**

##### è§£å†³æ–¹å¼ï¼ˆé…åˆ root ä½¿ç”¨ï¼‰ï¼š

| æ–¹æ³•                   | åŸç†                         | å·¥å…·æ¨è                  | è¯´æ˜               |
| ---------------------- | ---------------------------- | ------------------------- | ------------------ |
| å…³é—­ Pinningï¼ˆXposedï¼‰ | Hook æ‰ `checkServerTrusted` | JustTrustMeã€SSLUnpinning | ç®€å•ä½†æ£€æµ‹å®¹æ˜“     |
| åŠ¨æ€ Hook              | åŠ¨æ€ Hook ç½‘ç»œåº“ç±»æ–¹æ³•       | Frida + Objection         | çµæ´»ä¸”å¼ºå¤§         |
| ä¿®æ”¹ APK é‡ç­¾å        | åˆ é™¤ç½‘ç»œå®‰å…¨ä»£ç æˆ–è¯ä¹¦æ ¡éªŒ   | ApkTool + SignApk         | ä¸ç¨³å®šã€éœ€åç¼–è¯‘   |
| ä½¿ç”¨ Magisk æ¨¡å—       | ç³»ç»Ÿçº§æ³¨å…¥è¯ä¹¦               | `MagiskTrustUserCerts`    | æ ¹çº§åˆ«ç»•è¿‡ Pinning |