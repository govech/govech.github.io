---
title: åŒ…ä½“ç§¯ä¼˜åŒ–
date: 2025-07-16
---



AndroidåŒ…ä½“ç§¯ï¼ˆAPK/AABï¼‰ä¼˜åŒ–æ˜¯æå‡ç”¨æˆ·ä¸‹è½½è½¬åŒ–ç‡ã€å‡å°‘å­˜å‚¨å ç”¨å’ŒåŠ å¿«å®‰è£…é€Ÿåº¦çš„å…³é”®æ‰‹æ®µã€‚ä»¥ä¸‹æ˜¯ä¸€å¥—**ç³»ç»ŸåŒ–çš„ä¼˜åŒ–æ–¹æ¡ˆ**ï¼Œç»“åˆæœ€æ–°å·¥å…·é“¾ä¸å®è·µï¼Œåˆ†ä¸ºåˆ†æã€èµ„æºã€ä»£ç ã€é…ç½®ã€åŠ¨æ€åŒ–äº”å¤§æ–¹å‘ï¼š

------

### ğŸ” **ä¸€ã€åˆ†æå…ˆè¡Œï¼šå®šä½ä½“ç§¯å…ƒå‡¶**

1. **Android Studio APK Analyzer**

   `Build > Analyze APK`ç›´æ¥æŸ¥çœ‹APKå†…æ–‡ä»¶å æ¯”ï¼Œé‡ç‚¹å…³æ³¨ï¼š

   - `res/`ï¼ˆå›¾ç‰‡ã€å¸ƒå±€ï¼‰
   - `lib/`ï¼ˆåŸç”Ÿåº“ï¼‰
   - `classes.dex`ï¼ˆä»£ç ï¼‰
   - `assets/`ï¼ˆåŸå§‹èµ„æºï¼‰
   - `resources.arsc`ï¼ˆèµ„æºç´¢å¼•è¡¨ï¼‰

2. **AAPT2 èµ„æºåˆ†æ**

   ```
   # è¾“å‡ºèµ„æºæ˜ç»†
   ./gradlew :app:processDebugResources --scan
   ```

3. **ç¬¬ä¸‰æ–¹å·¥å…·**

   - **Matrix-ApkChecker**ï¼šè…¾è®¯å¼€æºçš„æ·±åº¦åˆ†æå·¥å…·
   - **Google Play Console**ï¼šå‘å¸ƒå‰AABä½“ç§¯åˆ†æ

------

### ğŸ–¼ï¸ **äºŒã€èµ„æºä¼˜åŒ–ï¼šå æ¯”é€šå¸¸æœ€å¤§**

#### 1. **å›¾ç‰‡å‹ç¼©ä¸æ ¼å¼ä¼˜åŒ–**

- **WebPæ›¿ä»£PNG/JPG**

  Android Studioå³é”®å›¾ç‰‡ > `Convert to WebP`ï¼ˆæ— æŸå‹ç¼©å¯çœ30-70%ï¼‰

- **TinyPNG/TinyJPG**ï¼šæœ‰æŸå‹ç¼©å·¥å…·ï¼ˆAPIæ”¯æŒæ‰¹é‡ï¼‰

- **SVGæ›¿ä»£ä½å›¾**ï¼šç®€å•å›¾æ ‡ç”¨VectorDrawableï¼ˆå•æ–‡ä»¶é€‚é…æ‰€æœ‰å¯†åº¦ï¼‰

- **AVIF/HEIF**ï¼šAndroid 12+æ”¯æŒçš„é«˜æ•ˆæ ¼å¼ï¼ˆéœ€æ£€æŸ¥å…¼å®¹æ€§ï¼‰

#### 2. **ç§»é™¤æœªä½¿ç”¨èµ„æº**

```groovy
android {
    buildTypes {
        release {
            shrinkResources true // é…åˆä»£ç æ··æ·†åˆ é™¤æ— ç”¨èµ„æº
            minifyEnabled true
        }
    }
}
```

- **æ‰‹åŠ¨æ‰«æ**ï¼š`Refactor > Remove Unused Resources`
- **Lintæ£€æŸ¥**ï¼š`./gradlew lint`æŸ¥æ‰¾ `UnusedResources`

#### 3. **èµ„æºæ··æ·†ä¸å‹ç¼©**

- **AndResGuard**ï¼ˆè…¾è®¯å¼€æºï¼‰

  æ··æ·†èµ„æºè·¯å¾„ï¼Œå‹ç¼©`resources.arsc`

  ```
  plugins { id 'com.tencent.mm:AndResGuard' }
  andResGuard { mappingFile = null // å…³é—­mappingä¿æŒå¯è¯»æ€§ }
  ```

- **å¾®ä¿¡èµ„æºå‹ç¼©æ–¹æ¡ˆ**ï¼šåˆå¹¶é‡å¤èµ„æºï¼ˆå¦‚åŒåä¸åŒç›®å½•å›¾ç‰‡ï¼‰

#### 4. **éŸ³é¢‘/å­—ä½“ä¼˜åŒ–**

- éŸ³é¢‘è½¬**Opus**æ ¼å¼ï¼ˆæ¯”MP3å°50%ï¼‰
- å­—ä½“å­é›†åŒ–ï¼šç”¨ **FontTools**æå–ä»…éœ€å­—ç¬¦

------

### ğŸ“¦ **ä¸‰ã€ä»£ç ä¼˜åŒ–ï¼šå‡å°‘DEXä¸åº“ä½“ç§¯**

#### 1. **å¯ç”¨ä»£ç æ··æ·†ä¸ä¼˜åŒ–**

```groovy
android {
    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
        }
    }
}
```

- é…ç½®è‡ªå®šä¹‰è§„åˆ™ä¿ç•™å¿…è¦ç±»ï¼ˆå¦‚åå°„è°ƒç”¨çš„ç±»ï¼‰

#### 2. **R8ä¼˜åŒ–å™¨**

R8ä¼˜åŒ–ï¼ˆæ›´é«˜æ•ˆï¼Œé»˜è®¤å¯ç”¨ï¼‰ï¼š

```groovy
android.enableR8 = true
android.enableR8.fullMode = true // æ¿€è¿›æ¨¡å¼ï¼ˆå¯èƒ½éœ€é¢å¤–é…ç½®ï¼‰
```

#### 3. **DEXæ‹†åˆ†ä¸åˆ†åŒ…**

```groovy
android {
    defaultConfig {
        multiDexEnabled true
    }
    buildTypes {
        release {
            // æ‹†åˆ†ä¸»DEX
            multiDexKeepProguard file('multidex-config.pro')
        }
    }
}
```

#### 4. **ä¾èµ–åº“ä¼˜åŒ–**

- **ä»…å¼•å…¥æ‰€éœ€æ¨¡å—**ï¼š

  ```groovy
  implementation 'com.google.android.material:material:1.11.0' 
  â†’ 
  implementation 'com.google.android.material:card:1.11.0' // åªå¼•å…¥CardView
  ```

- **é¿å…é‡å¤åº“**ï¼šæ£€æŸ¥`./gradlew :app:dependencies`è§£å†³å†²çª

- **ä½¿ç”¨è½»é‡æ›¿ä»£**ï¼šå¦‚ç”¨`AndroidX AppCompat`æ›¿ä»£å®Œæ•´ `Google Play Services`

------

### âš™ï¸ **å››ã€é…ç½®ä¼˜åŒ–ï¼šæ„å»ºä¸æ‰“åŒ…ç­–ç•¥**

#### 1. **ABIåˆ†åŒ…ï¼ˆé’ˆå¯¹åŸç”Ÿåº“ï¼‰**

```groovy
android {
    splits {
        abi {
            enable true
            reset()
            include 'armeabi-v7a', 'arm64-v8a', 'x86' // æŒ‰éœ€é€‰æ‹©
            universalApk false // ä¸ç”Ÿæˆå…¨å¹³å°åŒ…
        }
    }
}
```

- **Google Play App Bundle**ï¼šè‡ªåŠ¨åˆ†å‘é€‚é…è®¾å¤‡ABIçš„APK

#### 2. **è¯­è¨€èµ„æºè£å‰ª**

```groovy
android {
    defaultConfig {
        resConfigs "zh", "en" // ä»…ä¿ç•™ä¸­è‹±æ–‡
    }
}
```

#### 3. **ç§»é™¤å¤‡ç”¨èµ„æº**

```groovy
android {
    defaultConfig {
        resConfigs "xxhdpi", "xxxhdpi" // ä»…ä¿ç•™ä¸»æµDPI
    }
}
```

#### 4. **å‹ç¼©Nativeåº“ç¬¦å·è¡¨**

```groovy
android {
    packagingOptions {
        jniLibs {
            useLegacyPackaging false // å¯ç”¨ELFå‹ç¼©ï¼ˆAndroid Gradle Plugin 8.0+ï¼‰
        }
    }
}
```

------

### ğŸš€ **äº”ã€é«˜çº§ç­–ç•¥ï¼šåŠ¨æ€åŒ–ä¸äº‘ç«¯**

1. **åŠŸèƒ½åŠ¨æ€åŒ–**

   - **H5/å°ç¨‹åº**ï¼šéæ ¸å¿ƒåŠŸèƒ½ç”¨WebViewå®ç°

   - **Dynamic Feature Modules (DFM)**

     ```
     dynamicFeatures = [':feature_account']
     ```

     - æŒ‰éœ€ä¸‹è½½æ¨¡å—ï¼ˆéœ€Google Playæ”¯æŒï¼‰

2. **èµ„æºç½‘ç»œåŒ–**

   - é¦–æ¬¡å¯åŠ¨åä¸‹è½½å¤§èµ„æºï¼ˆå¦‚æ¸¸æˆç´ æã€è¯­éŸ³åŒ…ï¼‰
   - ä½¿ç”¨`WorkManager`ç®¡ç†ä¸‹è½½ä»»åŠ¡

3. **æ’ä»¶åŒ–æ¡†æ¶**ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

   - **RePlugin**ã€**Shadow**ï¼šåŠ¨æ€åŠ è½½æ’ä»¶APKï¼ˆéœ€è€ƒè™‘å…¼å®¹æ€§ä¸å®‰å…¨ï¼‰

------

### ğŸ“Š **å…­ã€ç›‘æ§ä¸æŒç»­ä¼˜åŒ–**

1. **CIé›†æˆä½“ç§¯æ£€æµ‹**

   ```yaml
   # GitHub Actionsç¤ºä¾‹
   - name: Check APK Size
     uses: mindspark/apk-size-check-action@v1
     with:
       maxSize: 50MB # è®¾ç½®é˜ˆå€¼
   ```

2. **AABåˆ†ææŠ¥å‘Š**

   ```bash
   bundletool build-apks --bundle=app.aab --output=app.apks
   bundletool get-size total --apks=app.apks
   ```

3. **ä½“ç§¯å‘Šè­¦**

   åœ¨MR/PRæµç¨‹ä¸­é›†æˆ**ApkTracker**ç­‰å·¥å…·



é€šè¿‡ä¸Šè¿°ç»„åˆæ‹³ï¼Œé€šå¸¸å¯å‡å°‘APKä½“ç§¯30%-70%ã€‚å»ºè®®æ¯æ¬¡ä¼˜åŒ–åå¯¹æ¯”å®‰è£…åŒ…å·®å¼‚ï¼ˆå¦‚ä½¿ç”¨`diffuse`å·¥å…·ï¼‰ï¼ŒæŒç»­è¿­ä»£æ‰èƒ½ä¿æŒâ€œç˜¦èº«â€æ•ˆæœã€‚