---
title: Androidå¤šæ¸ é“æ‰“åŒ…
date: 2025-07-19
---



Android å¤šæ¸ é“æ‰“åŒ…çš„æ ¸å¿ƒç›®æ ‡æ˜¯ä¸º**åŒä¸€ä»½åº”ç”¨ä»£ç **ç”Ÿæˆ**å¤šä¸ªä¸åŒæ¸ é“æ ‡è¯†**çš„ APK/AAB æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨åˆ†å‘åˆ°ä¸åŒåº”ç”¨å¸‚åœºï¼ˆå¦‚åä¸ºã€å°ç±³ã€åº”ç”¨å®ç­‰ï¼‰æˆ–è¿›è¡Œä¸åŒæ¨å¹¿æ´»åŠ¨æ—¶ï¼Œèƒ½å¤Ÿè¿½è¸ªåº”ç”¨çš„æ¥æºã€ç»Ÿè®¡æ¸ é“æ•ˆæœã€‚

ä»¥ä¸‹æ˜¯å‡ ç§ä¸»è¦çš„å®ç°æ–¹å¼åŠå…¶ä¼˜ç¼ºç‚¹ï¼š

### ğŸ“¦ 1. ä½¿ç”¨ Gradle Product Flavors (ä¼ ç»Ÿæ–¹å¼ - é€‚ç”¨äºå°‘é‡æ¸ é“)

- **åŸç†ï¼š** åˆ©ç”¨ Android Gradle Plugin æä¾›çš„ `productFlavors` DSLã€‚æ¯ä¸ª flavor ä»£è¡¨ä¸€ä¸ªæ¸ é“ï¼ˆæˆ–å˜ä½“ï¼‰ï¼ŒGradle ä¼šä¸ºæ¯ä¸ª flavor å•ç‹¬ç¼–è¯‘å’Œæ‰“åŒ… APK/AABã€‚

- å®ç°æ­¥éª¤:

  

  1. åœ¨build.gradle(Module) ä¸­å®šä¹‰ flavors:

     ```groovy
     android {
         flavorDimensions "channel"
         productFlavors {
             huawei {
                 dimension "channel"
                 // å¯ä»¥åœ¨è¿™é‡Œä¸ºç‰¹å®šæ¸ é“è®¾ç½®ä¸åŒçš„ applicationId, versionCode, res ç­‰ (å¯é€‰)
                 manifestPlaceholders = [CHANNEL_VALUE: "huawei"]
             }
             xiaomi {
                 dimension "channel"
                 manifestPlaceholders = [CHANNEL_VALUE: "xiaomi"]
             }
             tencent {
                 dimension "channel"
                 manifestPlaceholders = [CHANNEL_VALUE = "tencent"]
             }
             // ... æ·»åŠ æ›´å¤šæ¸ é“
         }
     }
     ```

  2. åœ¨AndroidManifest.xmlä¸­å®šä¹‰ä¸€ä¸ªå ä½ç¬¦ï¼Œç”¨äºæ¥æ”¶æ¸ é“ä¿¡æ¯ï¼š

     ```xml
     <manifest ...>
         <application ...>
             ...
             <!-- ä½¿ç”¨ ${CHANNEL_VALUE} å ä½ç¬¦ -->
             <meta-data
                 android:name="CHANNEL"
                 android:value="${CHANNEL_VALUE}" />
         </application>
     </manifest>
     ```

  3. åœ¨ä»£ç ä¸­è¯»å–æ¸ é“ä¿¡æ¯ï¼š

     ```java
     ApplicationInfo appInfo = context.getPackageManager().getApplicationInfo(context.getPackageName(), PackageManager.GET_META_DATA);
     String channel = appInfo.metaData.getString("CHANNEL");
     // æˆ–è€…ä½¿ç”¨å·¥å…·åº“å¦‚ AppMetaData.getChannel(context)
     ```

  4. **æ‰“åŒ…**ï¼š

     - å‘½ä»¤è¡Œï¼š`./gradlew assembleHuaweiRelease` (æ‰“åŒ…å•ä¸ªåä¸ºæ¸ é“ Release APK)
     - å‘½ä»¤è¡Œï¼š`./gradlew assembleRelease` (æ‰“åŒ…æ‰€æœ‰æ¸ é“çš„ Release APK)
     - Android Studioï¼šåœ¨ Build Variants é¢æ¿é€‰æ‹©å¯¹åº”çš„ flavor å’Œ build type è¿›è¡Œæ‰“åŒ…ã€‚

- **ä¼˜ç‚¹**:

  - å®˜æ–¹æ”¯æŒï¼Œé…ç½®æ¸…æ™°ç›´è§‚ã€‚
  - ä¸ä»…å¯ä»¥è®¾ç½®æ¸ é“ï¼Œè¿˜èƒ½ä¸ºä¸åŒæ¸ é“å®šåˆ¶ä»£ç ã€èµ„æºã€é…ç½®ç­‰ï¼ˆé€šè¿‡ `src/huawei/java`, `src/huawei/res` ç­‰ï¼‰ã€‚

- **ç¼ºç‚¹**:

  - **æ•ˆç‡æä½ï¼š** æ¯ä¸ªæ¸ é“éƒ½éœ€è¦**é‡æ–°æ‰§è¡Œå®Œæ•´çš„ç¼–è¯‘ã€èµ„æºå¤„ç†ã€æ‰“åŒ…ã€ç­¾å**è¿‡ç¨‹ã€‚æ¸ é“æ•°é‡å¤šæ—¶ï¼ˆå‡ åä¸Šç™¾ä¸ªï¼‰ï¼Œæ‰“åŒ…æ—¶é—´ä¼šå˜å¾—éå¸¸é•¿ï¼ˆå‡ ååˆ†é’Ÿç”šè‡³æ•°å°æ—¶ï¼‰ã€‚
  - ä¸»è¦ç”¨äºåŠŸèƒ½å·®å¼‚è¾ƒå¤§çš„å˜ä½“ï¼Œå¯¹äºä»…éœ€æ ‡è¯†ç¬¦ä¸åŒçš„æ¸ é“æ‰“åŒ…æ˜¾å¾—ç¬¨é‡ã€‚

### âš¡ 2. ä¿®æ”¹ APK æ–‡ä»¶ (é«˜æ•ˆæ–¹æ¡ˆ - ä¸»æµæ¨è)

è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**å…ˆæ‰“ä¸€ä¸ªæ¯åŒ…ï¼ˆä¸åŒ…å«æ¸ é“ä¿¡æ¯ï¼‰**ï¼Œç„¶åé€šè¿‡**åå¤„ç†å·¥å…·**ï¼Œ**å¿«é€Ÿã€é«˜æ•ˆåœ°**å‘æ¯åŒ…çš„**ç‰¹å®šä½ç½®**å†™å…¥æ¸ é“æ ‡è¯†ç¬¦ï¼Œç”Ÿæˆå¤šä¸ªæ¸ é“åŒ…ã€‚è¿™ä¸ªè¿‡ç¨‹**ä¸éœ€è¦é‡æ–°ç¼–è¯‘å’Œç­¾å**ï¼ˆå‰ææ˜¯å†™å…¥ä½ç½®ä¸å½±å“ç­¾åæ ¡éªŒï¼‰ã€‚

- **åŸç†ï¼š** APK æœ¬è´¨æ˜¯ ZIP æ–‡ä»¶ã€‚è¿™äº›å·¥å…·åˆ©ç”¨ ZIP æ ¼å¼çš„ç‰¹æ€§ï¼ˆå¦‚æ–‡ä»¶æœ«å°¾çš„ Central Directoryã€EOCDï¼Œæˆ– ZIP Commentï¼‰ï¼Œå°†æ¸ é“ä¿¡æ¯å†™å…¥è¿™äº›ä¸å½±å“ APK ç»“æ„å’Œç­¾åæ ¡éªŒçš„åŒºåŸŸã€‚

- **ä¸»æµå·¥å…·**:

  - **Meituan Walle:** è¾ƒæ—©çš„æµè¡Œæ–¹æ¡ˆï¼Œå°†æ¸ é“ä¿¡æ¯å†™å…¥ APK çš„ ZIP **Comment** åŒºåŸŸã€‚**å¯¹ v2/v3 ç­¾åå‹å¥½ã€‚**
  - **Tencent VasDolly:** åŠŸèƒ½æ›´å¼ºå¤§çš„å®˜æ–¹å·¥å…·åŒ…ã€‚å®ƒæä¾›äº†å¤šç§å†™å…¥æ–¹å¼ï¼ˆåŒ…æ‹¬ç±»ä¼¼ Walle çš„ Comment æ–¹å¼ï¼‰ï¼Œå¹¶**å®Œç¾æ”¯æŒ v2/v3/v4 ç­¾å**ã€‚æ˜¯ç›®å‰**æœ€æ¨è**çš„æ–¹æ¡ˆä¹‹ä¸€ã€‚

- **å®ç°æ­¥éª¤ (ä»¥ VasDolly ä¸ºä¾‹):**

  1. é…ç½®ä¾èµ–ï¼š

     - åœ¨æ ¹é¡¹ç›®çš„build.gradleä¸­æ·»åŠ ä»“åº“ï¼š

       ```groovy
       buildscript {
           repositories {
               google()
               mavenCentral()
               maven { url 'https://artifact.bytedance.com/repository/byteDance/' } // VasDolly ä»“åº“
           }
           dependencies {
               classpath 'com.bytedance.android:VasDolly:3.0.6' // æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬
               // ... å…¶ä»– classpath
           }
       }
       ```

     - åœ¨ App Module çš„build.gradleä¸­åº”ç”¨æ’ä»¶å¹¶æ·»åŠ  Helper ä¾èµ–ï¼š

       ```groovy
       apply plugin: 'com.bytedance.vasdolly'
       android {
           // ... ä½ çš„é…ç½®
       }
       dependencies {
           // ... å…¶ä»–ä¾èµ–
           implementation 'com.bytedance.android:VasDolly-helper:3.0.6' // ç”¨äºè¿è¡Œæ—¶è¯»å–æ¸ é“
       }
       ```

  2. **ç”Ÿæˆæ¯åŒ…ï¼š**ä½¿ç”¨ Gradle å‘½ä»¤ç”Ÿæˆä¸€ä¸ªæœªå†™å…¥ä»»ä½•æ¸ é“ä¿¡æ¯çš„ Release APKï¼š

     ```bash
     ./gradlew assembleRelease
     ```

  3. **ç”Ÿæˆæ¸ é“åŒ…**ï¼š

     - **æ–¹å¼ä¸€ (å‘½ä»¤è¡Œ)ï¼š**

       ```bash
       # ä½¿ç”¨ VasDolly å‘½ä»¤è¡Œå·¥å…· (jar åŒ…)
       java -jar vasdolly.jar put -c <channel_list_file> <input_apk> <output_dir>
       # ä¾‹å¦‚ï¼šjava -jar vasdolly.jar put -c channels.txt app-release.apk outputs/
       ```

       channels.txtæ–‡ä»¶æ¯è¡Œå†™ä¸€ä¸ªæ¸ é“åã€‚

     - **æ–¹å¼äºŒ (Gradle ä»»åŠ¡)ï¼š** VasDolly æ’ä»¶æä¾›äº† Gradle ä»»åŠ¡ï¼š

       ```bash
       ./gradlew channelDebug -PchannelFile=channels.txt
       ./gradlew channelRelease -PchannelFile=channels.txt
       ```

       è¿™ä¼šåœ¨build/outputs/channelç›®å½•ä¸‹ç”Ÿæˆæ¸ é“åŒ…ã€‚

  4. **åœ¨ä»£ç ä¸­è¯»å–æ¸ é“ä¿¡æ¯**ï¼šä½¿ç”¨ VasDolly Helper åº“ï¼š

     ```java
     import com.bytedance.applog.helper.channel.ChannelReader;
     // ...
     String channel = ChannelReader.getChannel(context); // è‡ªåŠ¨è¯»å– VasDolly å†™å…¥çš„æ¸ é“ä¿¡æ¯
     ```

- ä¼˜ç‚¹:

  - **æé€Ÿæ‰“åŒ…ï¼š** ç”Ÿæˆä¸€ä¸ªæ¸ é“åŒ…é€šå¸¸åªéœ€**å‡ ååˆ°å‡ ç™¾æ¯«ç§’**ï¼Œå³ä½¿ä¸Šç™¾ä¸ªæ¸ é“ä¹Ÿåªéœ€å‡ åˆ†é’Ÿã€‚è¿™æ˜¯å®ƒæœ€å¤§çš„ä¼˜åŠ¿ã€‚
  - **æ— éœ€ä¿®æ”¹æ„å»ºæµç¨‹ï¼š** åŸºäºæ¯åŒ…åå¤„ç†ï¼Œä¸å¹²æ‰°æ­£å¸¸çš„ç¼–è¯‘æ„å»ºã€‚
  - **ä¸»æµå·¥å…·æ”¯æŒå®Œå–„ï¼š** VasDolly å¯¹ Android ç­¾åæœºåˆ¶æ”¯æŒè‰¯å¥½ã€‚

- **ç¼ºç‚¹**:

  - éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹å·¥å…·/æ’ä»¶ã€‚
  - æ¸ é“ä¿¡æ¯å­˜å‚¨åœ¨ç‰¹å®šä½ç½®ï¼Œéœ€è¦ä½¿ç”¨é…å¥—çš„è¯»å–åº“ï¼ˆå¦‚ `ChannelReader.getChannel(context)`ï¼‰ã€‚
  - é€šå¸¸åªé€‚åˆå†™å…¥æ¸ é“æ ‡è¯†ç¬¦ç­‰å°‘é‡ä¿¡æ¯ï¼Œä¸é€‚åˆéœ€è¦ä¸ºä¸åŒæ¸ é“å®šåˆ¶ä»£ç /èµ„æºçš„æƒ…å†µã€‚

### ğŸ“Š æ€»ç»“ä¸å»ºè®®

1. **å°‘é‡æ¸ é“ ( < 10)ï¼Œä¸”å¯èƒ½éœ€è¦ä¸åŒå®šåˆ¶ï¼š** ä½¿ç”¨ **Gradle Product Flavors**ã€‚ç®€å•ç›´è§‚ã€‚
2. **ä¸­å¤§é‡æ¸ é“ ( >= 10)ï¼Œä¸»è¦åŒºåˆ«ä»…åœ¨äºæ¸ é“æ ‡è¯†ç¬¦ï¼š** **å¼ºçƒˆæ¨èä½¿ç”¨ä¿®æ”¹ APK æ–‡ä»¶çš„æ–¹å¼**ã€‚**Tencent VasDolly** æ˜¯ç›®å‰åŠŸèƒ½å®Œå–„ã€æ”¯æŒæ–°ç­¾åæ–¹æ¡ˆã€ç¤¾åŒºæ´»è·ƒçš„é¦–é€‰å·¥å…·ã€‚**Meituan Walle** ä¹Ÿæ˜¯ä¸€ä¸ªå¯é çš„é€‰æ‹©ã€‚

**æœ€ä½³å®è·µï¼š**

- ä½¿ç”¨ **VasDolly** è¿›è¡Œé«˜æ•ˆå¤šæ¸ é“æ‰“åŒ…ã€‚
- æ¯åŒ…ä½¿ç”¨ **v2/v3 (ç”šè‡³ v4) ç­¾å**ç¡®ä¿å®‰å…¨ã€‚
- åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼ˆå¦‚ `Application.onCreate()` ä¸­ï¼‰ï¼Œä½¿ç”¨ **VasDolly Helper (`ChannelReader.getChannel(context)`)** è¯»å–æ¸ é“ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å‚¨æˆ–ä¸ŠæŠ¥ç»™ç»Ÿè®¡æœåŠ¡ï¼ˆå¦‚å‹ç›Ÿã€Firebase Analyticsã€è‡ªå»ºæœåŠ¡ï¼‰ã€‚
- å°†æ¸ é“æ‰“åŒ…æ­¥éª¤é›†æˆåˆ° CI/CD æµç¨‹ä¸­ï¼ˆå¦‚ Jenkins, GitLab CIï¼‰ï¼Œå®ç°è‡ªåŠ¨åŒ–ã€‚

ğŸ’¡ **å…³é”®ç‚¹ï¼š** é€‰æ‹©å“ªç§æ–¹æ³•å–å†³äºä½ çš„æ¸ é“æ•°é‡å’Œéœ€æ±‚ã€‚å¯¹äºå¤§å¤šæ•°éœ€è¦è¿½è¸ªå¤§é‡åˆ†å‘æ¸ é“çš„åº”ç”¨ï¼ŒåŸºäº VasDolly æˆ– Walle çš„ APK ä¿®æ”¹æ–¹æ¡ˆæ˜¯æ•ˆç‡æœ€é«˜ã€æœ€å®ç”¨çš„é€‰æ‹©ã€‚